---
title: "Monkeypox World Dashboard"
output: 
  flexdashboard::flex_dashboard:
    orientation: rows
    vertical_layout: fill
---

```{r setup, include=FALSE}
library(flexdashboard)
library(dplyr)
library(readr)
library(tidyr)
library(ggplot2)
library(plotly)
library(tmap)
library(sf)
library(leaflet)

mpx_country_case_dat_v2 <- read_csv("exported data/mpx_country_case_dat_v2.csv")
mpx_gbl_hospitalizations <- read_csv("exported data/mpx_gbl_hospitalizations.csv")
```



```{r map processing, include=FALSE}
# import shapefile
world_shp <- st_read("C:\\Users\\Cindy Pang\\monkeypox-mapped\\countries sf\\World_Countries__Generalized_.shp")

# sort country case date to latest 
mpx_global_latest <- mpx_country_case_dat_v2 %>%
  group_by(Country)%>%
  filter(Date_confirmation == max(Date_confirmation), Country != "World")%>%
  select(Country, Date_confirmation, cumulative_confirmed, cumulative_confirmed_suspected, cumulative_confirmed_per_1M, cumulative_confirmed_suspected_per_1M)

mpx_global_map <- merge(world_shp,
                        mpx_global_latest,
                        by.x = "COUNTRY", 
                        by.y = "Country", 
                        all = FALSE)


```

Row {data-heighth=650, .tabset}
-----------------------------------------------------------------------

### Cumulative Confirmed Cases

```{r}
# tm_shape(mpx_global_map)+
#   tm_polygons("cumulative_confirmed_suspected")


# fig <- plot_geo(mpx_global_map)
# fig

bins <- c(0, 10, 20, 50, 100, 200, 500, 1000, Inf)
pal <- colorBin("YlOrRd", domain = mpx_global_map$cumulative_confirmed, bins = bins)
m <- leaflet(mpx_global_map)%>%
   addProviderTiles("MapBox", options = providerTileOptions(
    id = "mapbox.light",
    accessToken = Sys.getenv('MAPBOX_ACCESS_TOKEN')))%>%
  addPolygons(
    fillColor = ~pal(cumulative_confirmed),
  weight = 2,
  opacity = 1,
  color = "black",
  fillOpacity = 0.7
  )%>%
  addLegend(pal = pal, values = ~cumulative_confirmed, opacity = 0.7, title = NULL,
  position = "bottomright")


m
```

### Cumulative Cases & Suspected 
```{r}

pal <- colorBin("YlGnBu", domain = mpx_global_map$cumulative_confirmed_suspected, bins = bins)
m <- leaflet(mpx_global_map)%>%
   addProviderTiles("MapBox", options = providerTileOptions(
    id = "mapbox.light",
    accessToken = Sys.getenv('MAPBOX_ACCESS_TOKEN')))%>%
  addPolygons(
    fillColor = ~pal(cumulative_confirmed_suspected),
  weight = 2,
  opacity = 1,
  color = "black",
  fillOpacity = 0.7
  )%>%
  addLegend(pal = pal, values = ~cumulative_confirmed_suspected, opacity = 0.7, title = NULL,
  position = "bottomright")

m


```



### Cumulative Confirmed per Million 




### Cumulative Confirmed & Suspected per Million 


Row {data-height=350}
-----------------------------------------------------------------------

### Cumulative Case Trend

```{r}

```

### Chart C

```{r}

```

